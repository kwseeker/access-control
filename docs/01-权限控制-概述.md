# 权限控制－概述

**基本概念**：

+ **认证**

  Identification，根据声明者所特有的识别信息，确认声明者的身份。

  一般是用户输入自己的唯一的认证信息（用户名密码、手机号验证码、二维码、指纹等）与服务端存储的用户信息做校对。

+ **授权**

  管理员赋予用户访问某些资源的权限。

  像cookie-session、token（包括JWT）也属于授权机制，赋予用户访问接口的权限。

+ **鉴权**

  用户访问某些受权限控制保护的资源时，系统检查用户对这些资源的访问权限。

  比如校验上面 cookie-session、token（包括JWT）的合法性和有效性。

+ **权限控制**

  权限控制是指对可执行的各种操作组合配置为权限列表，然后根据执行者的权限，若其操作在权限范围内，则允许执行，否则禁止。 

  包括三个要素：

  - 主体（Subject) 指主动对其它实体施加动作的实体，如：管理员。
  - 客体(Object) 是被动接受其他实体访问的实体，如：要访问的某个文件。
  - 控制策略(Policy)为主体对客体的操作行为和约束条件，如：某个用户是否有对某个文件的访问权限。

**模型**：

+ **SSO** (Single Sign-on，统一身份认证)

  单点登录模型，即一次登录到处访问。

  + **CAS** (Central Authentication Service)

    是SSO的一种实现模型。

+ **ACL** (Access Control List, 权限控制列表)

  一种权限控制模型。

  每一个客体都配有一个列表，这个列表记录了主体对客体进行何种操作。当系统试图访问客体时，先检查这个列表中是否有关于当前用户的访问权限。如：

  ```yaml
  # 比如某个文件拥有以下用户及访问权限的记录列表
  Alice: read,write
  Bob: read
  ```

  典型场景：Linux文件系统 ACL、Zookeeper ACL。

+ **RBAC** (Role Based Access Control，基于角色的权限控制)

  一种权限控制模型。在用户和权限之间引入了角色（Role，是权限的集合）的概念，角色解耦了用户和权限之间的关系。

  角色/权限之间的变化比组（用户集合）/用户关系之间的变化相对要慢得多，减小了授权管理的复杂性。

  RBAC支持三个著名的**安全原则**：最小权限原则、责任分离原则和数据抽象原则

  - 最小权限原则：RBAC可以将角色配置成其完成任务所需的最小权限集合
  - 责任分离原则：可以通过调用相互独立互斥的角色来共同完成敏感的任务，例如要求一个计账员和财务管理员共同参与统一过账操作
  - 数据抽象原则：可以通过权限的抽象来体现，例如财务操作用借款、存款等抽象权限，而不是使用典型的读、写、执行权限

  RBAC分为４个层级：

  | 层级  | 角色层次 | 授权约束 | 说明                                                  |
  | ----- | -------- | -------- | ----------------------------------------------------- |
  | RBAC0 | 否       | 否       | 角色间不嵌套，授权时无约束                            |
  | RBAC1 | 是       | 否       | 角色间有嵌套，授权时无约束，即基于RBAC0引入了继承     |
  | RBAC2 | 否       | 是       | 角色间无嵌套，授权时有约束，即基于RBAC0引入了授权约束 |
  | RBAC3 | 是       | 是       | 角色间有嵌套，授权时有约束，整合了RBAC1和RBAC2        |

  > 角色间的嵌套：子层的角色**继承**父层的角色的**所有权限**
  >
  > 授权时的约束：按规则限制是否可以，如，某个用户授予某个角色，某个角色设置嵌套角色，等操作
  >
  > 约束示例：
  >
  > - 角色互斥，一个人具备某个角色，就不应该再被授予另一个角色
  > - 角色容量，一个角色能够授予的人数有上限，超出后不能再授予更多人
  > - 先决条件角色，仅当一个用户属于某个角色时，他才能被授予另一个角色
  > - 运行时排斥，一个用户可以同时具备两个角色，但是这两个角色同一时间只能激活一个角色使用

  RBAC基本数据模型：

  ![](img/ac_eer.png)

  对应的功能：

  + 用户管理
    + 查询用户列表
    + 添加用户
    + 编辑用户
    + 设置用户角色
  + 角色管理
    + 查询角色列表
    + 添加角色
    + 编辑角色
    + 设置角色权限
  + 权限管理
    + 查询权限列表
    + 添加权限
    + 编辑权限

+ **ABAC** (Attribute Based Access Control，基于属性的访问控制模型)

  通过动态计算一个或一组属性是否满足某种条件来进行授权判断。可以按需实现不同颗粒度的权限控制，但定义权限时不易看出用户和对象间的关系。如果规则复杂，容易给管理者带来维护和追查带来麻烦。

  属性通常来说分为四类：

  - 用户属性（如用户年龄)
  - 环境属性（如当前时间）
  - 操作属性（如读取)
  - 对象属性（如一篇文章，又称资源属性）

+ **DAC**

  根据自主访问控制策略建立的一种模型，允许合法用户以用户或用户组的身份访问策略规定的客体，同时阻止非授权用户访问客体。拥有客体权限的用户，可以将该客体的权限分配给其他用户。

  典型场景：Linux默认的访问控制模型。

+ **MAC**

  典型场景：SELinux的访问控制模型。

**技术实现**：

+ **spring-security**
+ **casbin**

+ **oauth**
+ **shiro**

